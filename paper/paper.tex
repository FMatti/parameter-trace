\documentclass[12pt]{article}

\usepackage{stylesheet}

% to speed up compilation speed a bit while drafting
\pdfcompresslevel=0
\pdfobjcompresslevel=0

\title{Randomized trace estimation for parameter-dependent matrices applied to spectral density approximation}

\begin{document}

\maketitle

%\todo{
%\begin{itemize}
%    \item Unify index notation
%    \item Double-check proofs
%    \item Add all references
%    \item Run numerical experiments 
%    \item Write introduction, abstract, and discussion
%    \item ArXiv HTML support (check if packages)
%\end{itemize}
%}

%\todo{
%    \tableofcontents
%}

\begin{abstract}
    Stochastic trace estimators are a family of well established techniques for approximating the trace of constant matrices. Oftentimes the matrix whose trace we aim to approximate continuously depends on a real parameter $t \in [a,b]$. This is for example the case when approximating the spectral density of a matrix or computing partition functions of quantum systems. Clearly, we could separately approximate the traces of the constant matrices $\mtx{B}(t_1), \dots, \mtx{B}(t_m)$ at the fixed values $t_1, \dots, t_m \in [a, b]$. However, this approach does not scale well if $m$ is large. We analyze three trace estimators for constant matrices -- the Girard-Hutchinson, Nyström, and Nyström++ estimators -- when they are applied to parameter-dependent matrices with the same randomization reused for all values of the parameter $t$. We show that all of these estimators closely match their corresponding error guarantees for constant matrices. In particular, for the Nyström++ method, we can guarantee an error of at most $\varepsilon$ by computing the estimate with just $\mathcal{O}(\varepsilon^{-1})$ random vectors, independent of what structure the symmetric positive semi-definite matrix $\mtx{B}(t)$ has. We employ these trace estimators to improve upon a technique for approximating the spectral density of a matrix and provide a detailed analysis of the resulting method. Finally, we confirm our theoretical developments in multiple numerical experiments.
\end{abstract}

\textcolor{red}{TODO for Fabio:
\begin{itemize}
 \item It is not great that the references occupy so much space (more than 4 pages); consider using a more condensed style. The paper needs to get strictly below 30 pages prior to submission. \textcolor{green}{Journal abbreviations, max 2 authors, omit superfluous fields $\to$ 3 pages.}
 Journal abbreviations and removing superfluous fields is good. max 2 authors is not coming in math, please reverse this. \textcolor{green}{Done.} The text style is a bit too generous but no need to change this now. \textcolor{green}{Ok! Let's talk about it at some point.}
\end{itemize}
}
\color{blue}
\input{intro.tex}
\input{analysis.tex}
\input{spectraldensity.tex}
%\input{numresults.tex}




\section{Conclusion}
\label{sec:conclusion}

\todo{
\begin{itemize}
    \item Robustness (can choose $m$ and $n_{\mtx{\Omega}}$, $n_{\mtx{\Psi}}$ as large as one wants, and not break algorithm, unlike Krylov-aware Lanczos)
\end{itemize}
}

\paragraph{Acknowledgements.} The authors gratefully acknowledge the help of Lin Lin in reproducing the example in \refsec{subsec:hamiltonian}. They thank David Persson for many enlightening discussions relating the proofs in \refsec{subsec:nystrom-pp}.

\printbibliography

\appendix

\section{Proofs}

\textcolor{red}{??? Need to check carefully that this result is not known ???} \textcolor{green}{I haven't found anything so far. The fact that also Bujanović/Grubišić/Kressner/Lam in Lemma 20 use a very similar technique, but merely to bound $\Gamma(\frac{p+1}{2})$ makes me suspect there's not much, except for Stirling approximation at the cost of some simplicity. Will keep investigating.}

\begin{lemma}{Moment bound of $\chi^2$-random variable}{gamma}
    Let $X$ follow a $\chi^2$ distribution with $k \in \mathbb{N}$ degrees of freedom. Then for all $p \in \mathbb{N}$ it holds
    \begin{equation}
        \mathbb{E}^{\sfrac{p}{2}}[X] \leq k + p
        %\frac{\Gamma(\frac{k + p}{2})}{\Gamma(\frac{k}{2})} \leq \left( \frac{k + p}{2} \right)^{\sfrac{p}{2}}.
    \end{equation}
\end{lemma}

\begin{proof}
    From \cite[Theorem 3.3.2]{hogg-2013-introduction-mathematical} we know
    \begin{equation}
        \mathbb{E}^{\sfrac{p}{2}}[X] = 2 \left( \frac{\Gamma(\frac{k + p}{2})}{\Gamma(\frac{k}{2})} \right)^{\sfrac{2}{p}}.
    \end{equation}
    We first treat the case $k=p=1$, for which indeed
    \begin{equation}
        2 \left( \frac{\Gamma(\frac{1+1}{2})}{\Gamma(\frac{1}{2})} \right)^2 = \frac{2}{\pi} \leq 2 = 1 + 1
    \end{equation}
    So we now assume $k + p \geq 3$. We can use a telescoping product and the property $\Gamma(z+1)/\Gamma(z) = z$ to bound
    \begin{align}
        \frac{\Gamma(\frac{k + p}{2})}{\Gamma(\frac{k}{2})} 
        &= \frac{\Gamma(\frac{k}{2} + 1)}{\Gamma(\frac{k}{2})} \frac{\Gamma(\frac{k}{2} + 2)}{\Gamma(\frac{k}{2} + 1)} \cdots \frac{\Gamma(\frac{k}{2} + \lfloor \frac{p}{2} \rfloor)}{\Gamma(\frac{k}{2} + \lfloor \frac{p}{2} \rfloor - 1)} \frac{\Gamma( \frac{k + p}{2})}{\Gamma(\frac{k}{2} + \lfloor \frac{p}{2} \rfloor)} \notag \\
        &= \left(\frac{k}{2}\right) \left(\frac{k}{2} + 1\right) \cdots \left( \frac{k}{2} + \bigg\lfloor \frac{p}{2} \bigg\rfloor - 1 \right) \frac{\Gamma( \frac{k + p}{2})}{\Gamma(\frac{k}{2} + \lfloor \frac{p}{2} \rfloor)} \notag \\
        &\leq \left(\frac{k}{2} + \bigg\lfloor \frac{p}{2} \bigg\rfloor - 1\right)^{\lfloor \sfrac{p}{2} \rfloor} \frac{\Gamma( \frac{k + p}{2})}{\Gamma(\frac{k}{2} + \lfloor \frac{p}{2} \rfloor)}
    \end{align}
    If $p$ is even, then $\lfloor p/2 \rfloor = p/2$ and hence
    \begin{equation}
        \frac{\Gamma(\frac{k + p}{2})}{\Gamma(\frac{k}{2})} 
        \leq \left( \frac{k + p}{2} - 1 \right)^{\sfrac{p}{2}}
        \leq \left( \frac{k + p}{2}\right)^{\sfrac{p}{2}}.
    \end{equation}
    If $p$ is odd, then $\lfloor p/2 \rfloor = (p - 1)/2$, from which follows with Gautschi's inequality \cite{kershaw-1983-extensions-gautschi}
    \begin{equation}
        \frac{\Gamma(\frac{k + p}{2})}{\Gamma(\frac{k}{2})}
        \leq \left(\frac{k + p}{2} - \frac{3}{2} \right)^{ \frac{p - 1}{2}} \frac{\Gamma( \frac{k + p}{2})}{\Gamma(\frac{k + p}{2} - \frac{1}{2})}
        \leq \left(\frac{k + p}{2}\right)^{ \frac{p - 1}{2}} \left(\frac{k + p}{2}\right)^{\sfrac{1}{2}}
        = \left(\frac{k + p}{2}\right)^{ \sfrac{p}{2}}
    \end{equation}
    Hence,
    \begin{equation}
        \mathbb{E}^{\sfrac{p}{2}}[X] \leq 2 \left( \frac{k + p}{2} \right) \leq k + p.
    \end{equation}
\end{proof}

\end{document}
